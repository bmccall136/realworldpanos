<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Maintaining Web Filtering on Take-Home Chromebooks (At Scale)</title>
  <meta name="description" content="PAC + pass-through proxies to keep PAN-OS web filtering working off-campus." />

  <!-- Site dark theme -->
  <link rel="stylesheet" href="../assets/css/site.css">

  <style>
    .post { margin-top: 18px; }
    .chips { display:flex; flex-wrap:wrap; gap:10px; margin: 14px 0 6px; }
    .chip { border:1px solid rgba(255,255,255,.12); color: rgba(255,255,255,.72); padding:6px 10px; border-radius: 999px; font-size: 13px; }
    .post h1 { margin: 14px 0 6px; line-height: 1.1; }
    .post h2 { margin: 26px 0 10px; }
    .post p { color: rgba(255,255,255,.72); }
    .callout {
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      border-radius: 14px;
      padding: 14px 14px;
      margin: 14px 0;
      color: rgba(255,255,255,.75);
    }
    .callout strong { color: rgba(255,255,255,.92); }
    pre, code {
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 12px;
      color: rgba(255,255,255,.85);
    }
    pre { padding: 12px 12px; overflow:auto; }
    code { padding: 2px 8px; }
    .hr { margin: 22px 0; }
  </style>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-K3FHP6L4TN"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-K3FHP6L4TN');
</script>

</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand"><a href="../index.html">RealWorldPANOS</a></div>
      <nav class="nav">
        <a href="../index.html#posts">Posts</a>
        <a href="../index.html#about">About</a>
        <a href="../index.html#contact">Contact</a>
      </nav>
    </div>
  </div>

  <div class="wrap post">
    <div class="chips">
      <span class="chip">PAN-OS</span>
      <span class="chip">K-12</span>
      <span class="chip">Chromebooks</span>
      <span class="chip">PAC</span>
      <span class="chip">Proxy</span>
      <span class="chip">Google Admin</span>
    </div>

    <h1>Maintaining Web Filtering on Take-Home Chromebooks (At Scale)</h1>
    <p class="lead">
      A field pattern: use PAC + pass-through proxies so off-campus traffic still traverses your Palo Alto policy stack —
      without turning your proxy layer into a filtering platform.
    </p>

    <div class="hr"></div>

    <h2>The design</h2>
    <ul>
      <li>Ubuntu instances running <strong>Apache</strong> (hosting the PAC file) and <strong>Squid</strong> (pass-through only; not filtering).</li>
      <li>Proxy settings pushed to <strong>Chromebooks via Google Admin</strong> (and iPads via MDM).</li>
      <li>Internal DNS intentionally does <strong>not</strong> resolve the proxy name → on-network traffic goes direct and is filtered normally.</li>
      <li>External DNS resolves the proxy name to a pool of proxies → off-network traffic lands on a proxy and still gets filtered.</li>
      <li>Palo Alto enforces <strong>user authentication</strong> for proxy use — if you’re not authenticated, nothing works.</li>
    </ul>

    <div class="callout">
      <strong>Key point:</strong> Squid is just a transport hop to force traffic back through the firewall. Filtering stays on PAN-OS.
    </div>

    <h2>PAC behavior</h2>
    <p>
      The PAC file sends selected domains <code>DIRECT</code> and proxies everything else to Squid on <code>:8080</code>.
      (Sanitize your real domain list before publishing.)
    </p>

    <pre><code>function FindProxyForURL(url, host)
{
  // Example: force specific domains through proxy
  if (shExpMatch(host, "sites.google.com"))
    return "PROXY proxy.example.org:8080";

  // Example: direct-list (sanitized)
  else if (
    shExpMatch(host, "*.example.org") ||
    shExpMatch(host, "*.google.com") ||
    shExpMatch(host, "*.gstatic.com") ||
    shExpMatch(host, "*.googleapis.com") ||
    shExpMatch(host, "*.googleusercontent.com")
  )
    return "DIRECT";

  // Default: proxy everything else
  return "PROXY proxy.example.org:8080";
}</code></pre>

    <h2>Authentication enforcement</h2>
    <ul>
      <li>A Chrome extension authenticates users to the firewall using their external IP context.</li>
      <li>A separate re-auth method exists via a website tied to AD + PAN-OS API (best as its own dedicated post).</li>
    </ul>

    <div class="hr"></div>

    <p class="muted" style="margin:0;">
      Next follow-ups: (1) the Chrome extension workflow, (2) the re-auth website workflow.
    </p>

    <div class="footer" style="margin-top:22px;">
      All views are my own and do not represent my employer. © 2025 RealWorldPANOS
    </div>
  </div>
</body>
</html>
